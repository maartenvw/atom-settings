'use strict';

var fse = require('fs-extra');
var glob = require('glob');
var path = require('path');

function cleanForPublish() {
  var location = arguments.length <= 0 || arguments[0] === undefined ? process.cwd() : arguments[0];
  var extensions = arguments.length <= 1 || arguments[1] === undefined ? ['.node', '.pdb'] : arguments[1];

  var savePattern = path.join(location, 'build', '**', '@(*' + extensions.join('|*') + ')');
  var killPattern = path.join(location, 'build', '**');
  var save = glob.sync(savePattern);
  var kill = glob.sync(killPattern).filter(function (bad) {
    return !save.some(function (good) {
      return good.indexOf(bad) == 0;
    });
  });
  console.log('cleaning ' + kill.length + ' file(s)');

  kill.forEach(function (file) {
    fse.removeSync(file);
  });
}
module.exports = cleanForPublish;